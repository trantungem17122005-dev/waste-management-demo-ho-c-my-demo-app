<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Phần mềm Quản lý Thu gom Rác</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .container-wrapper {
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* gap-6 */
            padding: 1.5rem; /* p-6 */
            max-width: 1200px;
            margin: auto;
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .container-wrapper {
                flex-direction: row;
            }
        }
        /* Custom scrollbar for better aesthetics */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Header / View Toggles -->
    <div class="w-full max-w-4xl bg-white p-4 rounded-xl shadow-lg mb-6 flex justify-center gap-4">
        <button id="driverAppBtn" class="px-6 py-3 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 transition-colors shadow-md">
            Ứng dụng Tài xế
        </button>
        <button id="dashboardBtn" class="px-6 py-3 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors shadow-md">
            Dashboard Trung tâm
        </button>
    </div>

    <!-- Main Container Wrapper for Driver App and Dashboard -->
    <div class="container-wrapper">

        <!-- Driver App Section -->
        <div id="driverApp" class="w-full lg:w-1/2 bg-white rounded-xl shadow-lg p-6 flex flex-col gap-6 transform transition-transform duration-300 ease-in-out">
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Ứng dụng Tài xế</h2>

            <!-- Màn hình 1: Lộ trình hiện tại -->
            <div id="driverScreen1" class="bg-blue-50 p-6 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold text-blue-800 mb-4">Lộ trình hôm nay</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                    <p><strong>Lộ trình:</strong> LT-001</p>
                    <p><strong>Xe:</strong> 29A-123.45</p>
                    <p><strong>Tài xế:</strong> Trần Tùng Em</p>
                    <p><strong>Điểm dừng còn lại:</strong> <span class="font-bold text-blue-600">5/15</span></p>
                </div>
                <div class="mt-6 bg-gray-200 h-48 rounded-lg flex items-center justify-center text-gray-500 text-sm italic">
                    [Bản đồ lộ trình tương tác]
                </div>
                <div class="mt-6">
                    <h4 class="font-semibold text-gray-800 mb-2">Danh sách điểm dừng</h4>
                    <ul class="space-y-3 overflow-y-auto max-h-60 pr-2">
                        <!-- Example Bin Item -->
                        <li class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors" data-bin-id="TR-101" data-bin-status="full">
                            <div>
                                <p class="font-medium text-gray-900">Thùng rác: TR-101</p>
                                <p class="text-sm text-gray-600">123 Đường B, Phường X</p>
                            </div>
                            <span class="px-3 py-1 text-sm font-semibold rounded-full bg-red-100 text-red-800">95% Đầy</span>
                        </li>
                        <li class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors" data-bin-id="TR-102" data-bin-status="near-full">
                            <div>
                                <p class="font-medium text-gray-900">Thùng rác: TR-102</p>
                                <p class="text-sm text-gray-600">456 Đường C, Phường Y</p>
                            </div>
                            <span class="px-3 py-1 text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800">70% Gần đầy</span>
                        </li>
                         <li class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors" data-bin-id="TR-103" data-bin-status="collected">
                            <div>
                                <p class="font-medium text-gray-900">Thùng rác: TR-103</p>
                                <p class="text-sm text-gray-600">789 Đường D, Phường Z</p>
                            </div>
                            <span class="px-3 py-1 text-sm font-semibold rounded-full bg-green-100 text-green-800">Đã thu gom</span>
                        </li>
                        <li class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors" data-bin-id="TR-104" data-bin-status="full">
                            <div>
                                <p class="font-medium text-gray-900">Thùng rác: TR-104</p>
                                <p class="text-sm text-gray-600">101 Đường E, Phường A</p>
                            </div>
                            <span class="px-3 py-1 text-sm font-semibold rounded-full bg-red-100 text-red-800">90% Đầy</span>
                        </li>
                        <li class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors" data-bin-id="TR-105" data-bin-status="near-full">
                            <div>
                                <p class="font-medium text-gray-900">Thùng rác: TR-105</p>
                                <p class="text-sm text-gray-600">202 Đường F, Phường B</p>
                            </div>
                            <span class="px-3 py-1 text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800">65% Gần đầy</span>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Màn hình 2: Chi tiết thùng rác (ẩn ban đầu) -->
            <div id="driverScreen2" class="bg-green-50 p-6 rounded-lg shadow-inner hidden">
                <h3 class="text-xl font-semibold text-green-800 mb-4">Chi tiết thùng rác: <span id="binDetailId"></span></h3>
                <div class="grid grid-cols-1 gap-4 text-gray-700">
                    <p><strong>Địa chỉ:</strong> <span id="binDetailAddress"></span></p>
                    <p><strong>Mức đầy:</strong> <span id="binDetailLevel" class="font-bold"></span></p>
                    <p><strong>Lần thu gom gần nhất:</strong> <span id="binDetailLastCollected"></span></p>
                    <div>
                        <label for="binDetailNotes" class="block text-sm font-medium text-gray-700 mb-1">Ghi chú:</label>
                        <textarea id="binDetailNotes" rows="3" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                </div>
                <div class="mt-6 flex flex-col sm:flex-row gap-4">
                    <button id="markCollectedBtn" class="flex-1 px-6 py-3 rounded-lg font-semibold text-white bg-green-600 hover:bg-green-700 transition-colors shadow-md">
                        Đã thu gom
                    </button>
                    <button id="reportIssueBtn" class="flex-1 px-6 py-3 rounded-lg font-semibold text-gray-700 bg-red-200 hover:bg-red-300 transition-colors shadow-md">
                        Báo cáo sự cố
                    </button>
                </div>
                <button id="backToDriverListBtn" class="mt-4 w-full px-6 py-3 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors shadow-md">
                    Quay lại danh sách
                </button>
            </div>

            <!-- Màn hình 3: Báo cáo sự cố (ẩn ban đầu) -->
            <div id="driverScreen3" class="bg-red-50 p-6 rounded-lg shadow-inner hidden">
                <h3 class="text-xl font-semibold text-red-800 mb-4">Báo cáo sự cố</h3>
                <div class="space-y-3">
                    <label class="flex items-center">
                        <input type="radio" name="issueType" value="broken" class="form-radio text-red-600">
                        <span class="ml-2 text-gray-700">Thùng rác bị hỏng</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="issueType" value="blocked" class="form-radio text-red-600">
                        <span class="ml-2 text-gray-700">Đường đi bị tắc</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="issueType" value="overflow" class="form-radio text-red-600">
                        <span class="ml-2 text-gray-700">Lượng rác quá lớn</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="issueType" value="other" class="form-radio text-red-600">
                        <span class="ml-2 text-gray-700">Lý do khác:</span>
                    </label>
                    <textarea id="otherIssueNotes" rows="3" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 mt-2"></textarea>
                </div>
                <div class="mt-6 flex flex-col sm:flex-row gap-4">
                    <button id="submitIssueBtn" class="flex-1 px-6 py-3 rounded-lg font-semibold text-white bg-red-600 hover:bg-red-700 transition-colors shadow-md">
                        Gửi báo cáo
                    </button>
                    <button id="cancelIssueBtn" class="flex-1 px-6 py-3 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors shadow-md">
                        Hủy
                    </button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="w-full lg:w-1/2 bg-white rounded-xl shadow-lg p-6 flex flex-col gap-6 transform transition-transform duration-300 ease-in-out hidden">
            <h2 class="text-2xl font-bold text-gray-800 text-center mb-4">Dashboard Trung tâm</h2>

            <!-- Màn hình 1: Tổng quan -->
            <div id="dashboardScreen1" class="bg-purple-50 p-6 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold text-purple-800 mb-4">Tổng quan hệ thống</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-purple-200">
                        <p class="text-sm text-gray-600">Tổng số thùng rác</p>
                        <p class="text-3xl font-bold text-purple-700">150</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-purple-200">
                        <p class="text-sm text-gray-600">Thùng cần thu gom ngay</p>
                        <p class="text-3xl font-bold text-red-600">50</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-purple-200">
                        <p class="text-sm text-gray-600">Xe đang hoạt động</p>
                        <p class="text-3xl font-bold text-green-600">10/12</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-purple-200">
                        <p class="text-sm text-gray-600">Sự cố chưa xử lý</p>
                        <p class="text-3xl font-bold text-orange-500">3</p>
                    </div>
                </div>
                <div class="mt-6 bg-gray-200 h-64 rounded-lg flex items-center justify-center text-gray-500 text-sm italic">
                    [Bản đồ tổng thể & Biểu đồ thống kê]
                </div>
                <button id="viewRoutesBtn" class="mt-6 w-full px-6 py-3 rounded-lg font-semibold text-white bg-purple-600 hover:bg-purple-700 transition-colors shadow-md">
                    Xem Lộ trình & Thùng rác chi tiết
                </button>
            </div>

            <!-- Màn hình 2: Quản lý Lộ trình & Thùng rác (ẩn ban đầu) -->
            <div id="dashboardScreen2" class="bg-indigo-50 p-6 rounded-lg shadow-inner hidden">
                <h3 class="text-xl font-semibold text-indigo-800 mb-4">Quản lý Lộ trình & Thùng rác</h3>

                <!-- Tabs for Routes and Bins -->
                <div class="flex border-b border-gray-200 mb-4">
                    <button id="routesTab" class="py-2 px-4 text-sm font-medium text-indigo-700 border-b-2 border-indigo-500 focus:outline-none">Lộ trình</button>
                    <button id="binsTab" class="py-2 px-4 text-sm font-medium text-gray-600 hover:text-indigo-700 hover:border-indigo-500 focus:outline-none">Thùng rác</button>
                </div>

                <!-- Routes List -->
                <div id="routesContent">
                    <h4 class="font-semibold text-gray-800 mb-2">Danh sách lộ trình</h4>
                    <div class="overflow-x-auto rounded-lg shadow-sm border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Lộ trình</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Xe</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tài xế</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bắt đầu</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kết thúc (DK)</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">LT-001</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Đang hoạt động</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">29A-123.45</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Trần Tùng Em</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">08:00 AM</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12:00 PM</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">LT-002</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Chờ xử lý</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Bins List (hidden initially) -->
                <div id="binsContent" class="hidden">
                    <h4 class="font-semibold text-gray-800 mb-2">Danh sách thùng rác</h4>
                    <div class="overflow-x-auto rounded-lg shadow-sm border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mã Thùng</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Địa chỉ</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mức đầy</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trạng thái</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lần thu gom gần nhất</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">TR-101</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">123 Đường B, Phường X</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">95%</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Cần thu gom</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-08-05</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">TR-102</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">456 Đường C, Phường Y</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">70%</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Gần đầy</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-08-05</td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">TR-103</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">789 Đường D, Phường Z</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">20%</td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Đã thu gom</span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-08-06</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <button id="backToDashboardOverviewBtn" class="mt-6 w-full px-6 py-3 rounded-lg font-semibold text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors shadow-md">
                    Quay lại Tổng quan
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Message Box -->
    <div id="messageBox" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center max-w-sm w-full">
            <h3 id="messageBoxTitle" class="text-xl font-bold mb-4 text-gray-800"></h3>
            <p id="messageBoxContent" class="text-gray-700 mb-6"></p>
            <button id="messageBoxCloseBtn" class="px-6 py-3 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700 transition-colors shadow-md">
                Đóng
            </button>
        </div>
    </div>

    <script>
        // Dummy data for demonstration
        const binsData = {
            "TR-101": { address: "123 Đường B, Phường X", level: "95% Đầy", lastCollected: "2025-08-05 10:30 AM", status: "full" },
            "TR-102": { address: "456 Đường C, Phường Y", level: "70% Gần đầy", lastCollected: "2025-08-05 11:00 AM", status: "near-full" },
            "TR-103": { address: "789 Đường D, Phường Z", level: "20% Đã thu gom", lastCollected: "2025-08-06 09:00 AM", status: "collected" },
            "TR-104": { address: "101 Đường E, Phường A", level: "90% Đầy", lastCollected: "2025-08-05 12:00 PM", status: "full" },
            "TR-105": { address: "202 Đường F, Phường B", level: "65% Gần đầy", lastCollected: "2025-08-05 01:00 PM", status: "near-full" }
        };

        // Get elements
        const driverAppBtn = document.getElementById('driverAppBtn');
        const dashboardBtn = document.getElementById('dashboardBtn');
        const driverAppSection = document.getElementById('driverApp');
        const dashboardSection = document.getElementById('dashboard');

        // Driver App Screens
        const driverScreen1 = document.getElementById('driverScreen1');
        const driverScreen2 = document.getElementById('driverScreen2');
        const driverScreen3 = document.getElementById('driverScreen3');

        // Driver App Detail Elements
        const binDetailId = document.getElementById('binDetailId');
        const binDetailAddress = document.getElementById('binDetailAddress');
        const binDetailLevel = document.getElementById('binDetailLevel');
        const binDetailLastCollected = document.getElementById('binDetailLastCollected');
        const binDetailNotes = document.getElementById('binDetailNotes');

        // Driver App Buttons
        const markCollectedBtn = document.getElementById('markCollectedBtn');
        const reportIssueBtn = document.getElementById('reportIssueBtn');
        const backToDriverListBtn = document.getElementById('backToDriverListBtn');
        const submitIssueBtn = document.getElementById('submitIssueBtn');
        const cancelIssueBtn = document.getElementById('cancelIssueBtn');

        // Dashboard Screens
        const dashboardScreen1 = document.getElementById('dashboardScreen1');
        const dashboardScreen2 = document.getElementById('dashboardScreen2');

        // Dashboard Buttons
        const viewRoutesBtn = document.getElementById('viewRoutesBtn');
        const backToDashboardOverviewBtn = document.getElementById('backToDashboardOverviewBtn');
        const routesTab = document.getElementById('routesTab');
        const binsTab = document.getElementById('binsTab');
        const routesContent = document.getElementById('routesContent');
        const binsContent = document.getElementById('binsContent');

        // Message Box Elements
        const messageBox = document.getElementById('messageBox');
        const messageBoxTitle = document.getElementById('messageBoxTitle');
        const messageBoxContent = document.getElementById('messageBoxContent');
        const messageBoxCloseBtn = document.getElementById('messageBoxCloseBtn');

        let currentBinId = null; // To store the ID of the currently selected bin in driver app

        // --- Utility Functions ---

        // Function to show custom message box
        function showMessageBox(title, message) {
            messageBoxTitle.textContent = title;
            messageBoxContent.textContent = message;
            messageBox.classList.remove('hidden');
        }

        // Function to hide custom message box
        function hideMessageBox() {
            messageBox.classList.add('hidden');
        }

        // --- Event Listeners ---

        // Toggle between Driver App and Dashboard
        driverAppBtn.addEventListener('click', () => {
            driverAppSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
            driverAppBtn.classList.add('bg-blue-600', 'text-white');
            driverAppBtn.classList.remove('bg-gray-200', 'text-gray-700');
            dashboardBtn.classList.add('bg-gray-200', 'text-gray-700');
            dashboardBtn.classList.remove('bg-blue-600', 'text-white');
        });

        dashboardBtn.addEventListener('click', () => {
            dashboardSection.classList.remove('hidden');
            driverAppSection.classList.add('hidden');
            dashboardBtn.classList.add('bg-blue-600', 'text-white');
            dashboardBtn.classList.remove('bg-gray-200', 'text-gray-700');
            driverAppBtn.classList.add('bg-gray-200', 'text-gray-700');
            driverAppBtn.classList.remove('bg-blue-600', 'text-white');
        });

        // Driver App: Handle clicking on a bin item to show details
        document.querySelectorAll('#driverScreen1 ul li').forEach(item => {
            item.addEventListener('click', () => {
                currentBinId = item.dataset.binId;
                const binInfo = binsData[currentBinId];

                if (binInfo) {
                    binDetailId.textContent = currentBinId;
                    binDetailAddress.textContent = binInfo.address;
                    binDetailLevel.textContent = binInfo.level;
                    binDetailLastCollected.textContent = binInfo.lastCollected;
                    binDetailNotes.value = ''; // Clear notes when opening
                    driverScreen1.classList.add('hidden');
                    driverScreen2.classList.remove('hidden');
                }
            });
        });

        // Driver App: Mark as Collected button
        markCollectedBtn.addEventListener('click', () => {
            if (currentBinId) {
                // Simulate updating status in dummy data
                binsData[currentBinId].status = "collected";
                binsData[currentBinId].level = "20% Đã thu gom";
                binsData[currentBinId].lastCollected = new Date().toLocaleString('vi-VN');

                // Update UI for the collected bin in the list
                const collectedBinElement = document.querySelector(`#driverScreen1 ul li[data-bin-id="${currentBinId}"]`);
                if (collectedBinElement) {
                    collectedBinElement.dataset.binStatus = "collected";
                    const statusSpan = collectedBinElement.querySelector('span');
                    statusSpan.textContent = "Đã thu gom";
                    statusSpan.classList.remove('bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800');
                    statusSpan.classList.add('bg-green-100', 'text-green-800');
                }

                showMessageBox('Thành công', `Thùng rác ${currentBinId} đã được đánh dấu là đã thu gom.`);
                driverScreen2.classList.add('hidden');
                driverScreen1.classList.remove('hidden');
            }
        });

        // Driver App: Report Issue button
        reportIssueBtn.addEventListener('click', () => {
            driverScreen2.classList.add('hidden');
            driverScreen3.classList.remove('hidden');
        });

        // Driver App: Back to list button from detail screen
        backToDriverListBtn.addEventListener('click', () => {
            driverScreen2.classList.add('hidden');
            driverScreen1.classList.remove('hidden');
        });

        // Driver App: Submit Issue button
        submitIssueBtn.addEventListener('click', () => {
            const selectedIssue = document.querySelector('input[name="issueType"]:checked');
            const otherNotes = document.getElementById('otherIssueNotes').value;
            let issueDescription = '';

            if (selectedIssue) {
                issueDescription = selectedIssue.value;
                if (issueDescription === 'other' && otherNotes) {
                    issueDescription = `Lý do khác: ${otherNotes}`;
                } else if (issueDescription === 'broken') {
                    issueDescription = 'Thùng rác bị hỏng';
                } else if (issueDescription === 'blocked') {
                    issueDescription = 'Đường đi bị tắc';
                } else if (issueDescription === 'overflow') {
                    issueDescription = 'Lượng rác quá lớn';
                }
            } else if (otherNotes) {
                issueDescription = `Lý do khác: ${otherNotes}`;
            } else {
                showMessageBox('Lỗi', 'Vui lòng chọn loại sự cố hoặc nhập ghi chú.');
                return;
            }

            showMessageBox('Báo cáo đã gửi', `Đã gửi báo cáo sự cố cho thùng rác ${currentBinId}: ${issueDescription}`);
            driverScreen3.classList.add('hidden');
            driverScreen1.classList.remove('hidden');
        });

        // Driver App: Cancel Issue button
        cancelIssueBtn.addEventListener('click', () => {
            driverScreen3.classList.add('hidden');
            driverScreen2.classList.remove('hidden'); // Go back to bin detail
        });

        // Message Box Close Button
        messageBoxCloseBtn.addEventListener('click', hideMessageBox);

        // Dashboard: View Routes & Bins button
        viewRoutesBtn.addEventListener('click', () => {
            dashboardScreen1.classList.add('hidden');
            dashboardScreen2.classList.remove('hidden');
            // Ensure Routes tab is active by default
            routesTab.click();
        });

        // Dashboard: Back to Overview button
        backToDashboardOverviewBtn.addEventListener('click', () => {
            dashboardScreen2.classList.add('hidden');
            dashboardScreen1.classList.remove('hidden');
        });

        // Dashboard: Tab switching for Routes and Bins
        routesTab.addEventListener('click', () => {
            routesTab.classList.add('border-indigo-500', 'text-indigo-700');
            routesTab.classList.remove('border-transparent', 'text-gray-600', 'hover:text-indigo-700');
            binsTab.classList.add('border-transparent', 'text-gray-600', 'hover:text-indigo-700');
            binsTab.classList.remove('border-indigo-500', 'text-indigo-700');
            routesContent.classList.remove('hidden');
            binsContent.classList.add('hidden');
        });

        binsTab.addEventListener('click', () => {
            binsTab.classList.add('border-indigo-500', 'text-indigo-700');
            binsTab.classList.remove('border-transparent', 'text-gray-600', 'hover:text-indigo-700');
            routesTab.classList.add('border-transparent', 'text-gray-600', 'hover:text-indigo-700');
            routesTab.classList.remove('border-indigo-500', 'text-indigo-700');
            binsContent.classList.remove('hidden');
            routesContent.classList.add('hidden');
        });

        // Initial state: Show Driver App by default
        document.addEventListener('DOMContentLoaded', () => {
            driverAppBtn.click();
        });

    </script>
</body>
</html>
